<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Code Explorer</title>
    <style>
        /* Main Application Styles */
        :root {
            --primary-color: #6e48aa;
            --secondary-color: #9d50bb;
            --dark-color: #1a1a2e;
            --darker-color: #16213e;
            --light-color: #e6f7ff;
            --accent-color: #00d4ff;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background-color: var(--dark-color);
            color: var(--light-color);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        #app-container {
            display: grid;
            grid-template-areas:
                "header header header"
                "sidebar main tools"
                "footer footer footer";
            grid-template-columns: 300px 1fr 300px;
            grid-template-rows: 60px 1fr 40px;
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        /* WebGL Canvas */
        #cosmic-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            width: 100%;
            height: 100%;
        }

        /* Header Styles */
        .app-header {
            grid-area: header;
            background-color: rgba(30, 30, 60, 0.8);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid var(--secondary-color);
            z-index: 10;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .header-controls {
            display: flex;
            gap: 15px;
        }

        .header-btn {
            background: rgba(110, 72, 170, 0.3);
            border: 1px solid var(--secondary-color);
            color: var(--light-color);
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: rgba(110, 72, 170, 0.6);
            box-shadow: 0 0 10px rgba(157, 80, 187, 0.5);
        }

        /* Sidebar Styles */
        .app-sidebar {
            grid-area: sidebar;
            background-color: rgba(22, 33, 62, 0.8);
            border-right: 1px solid var(--secondary-color);
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--accent-color);
            border-bottom: 1px solid var(--secondary-color);
            padding-bottom: 5px;
        }

        .tutorial-list {
            list-style: none;
        }

        .tutorial-item {
            padding: 8px 10px;
            margin-bottom: 5px;
            background: rgba(110, 72, 170, 0.2);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tutorial-item:hover {
            background: rgba(110, 72, 170, 0.4);
        }

        .tutorial-item.active {
            background: var(--secondary-color);
            font-weight: bold;
        }

        .collab-users {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 4px;
        }

        .user-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Main Content Styles */
        .app-main {
            grid-area: main;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .editor-toolbar {
            background: rgba(30, 30, 60, 0.7);
            padding: 5px 10px;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid var(--secondary-color);
        }

        .toolbar-btn {
            background: none;
            border: none;
            color: var(--light-color);
            cursor: pointer;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.9rem;
        }

        .toolbar-btn:hover {
            background: rgba(110, 72, 170, 0.3);
        }

        #code-editor {
            flex: 1;
            background: rgba(10, 10, 30, 0.8);
            color: var(--light-color);
            padding: 15px;
            border: none;
            resize: none;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            tab-size: 2;
        }

        #code-editor:focus {
            outline: none;
        }

        .console-container {
            height: 200px;
            background: rgba(0, 0, 20, 0.9);
            border-top: 1px solid var(--secondary-color);
            overflow-y: auto;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .console-line {
            margin-bottom: 5px;
            white-space: pre-wrap;
        }

        .console-line.info {
            color: var(--light-color);
        }

        .console-line.success {
            color: var(--success-color);
        }

        .console-line.warning {
            color: var(--warning-color);
        }

        .console-line.error {
            color: var(--error-color);
        }

        /* Tools Panel Styles */
        .app-tools {
            grid-area: tools;
            background-color: rgba(22, 33, 62, 0.8);
            border-left: 1px solid var(--secondary-color);
            overflow-y: auto;
            padding: 15px;
        }

        .metrics-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .metric-card {
            background: rgba(110, 72, 170, 0.2);
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .metric-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .visualizer-container {
            margin-top: 20px;
            height: 150px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .audio-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: var(--accent-color);
            border-radius: 2px 2px 0 0;
            transition: height 0.1s;
        }

        /* Footer Styles */
        .app-footer {
            grid-area: footer;
            background-color: rgba(30, 30, 60, 0.8);
            border-top: 1px solid var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
        }

        /* Plugin System Styles */
        .plugins-container {
            margin-top: 20px;
        }

        .plugin-card {
            background: rgba(110, 72, 170, 0.2);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .plugin-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .plugin-name {
            font-weight: bold;
        }

        .plugin-btn {
            background: rgba(0, 212, 255, 0.2);
            border: none;
            color: var(--light-color);
            padding: 2px 8px;
            border-radius: 3px;
            cursor: pointer;
        }

        .plugin-btn:hover {
            background: rgba(0, 212, 255, 0.4);
        }

        /* Responsive Adjustments */
        @media (max-width: 1200px) {
            #app-container {
                grid-template-areas:
                    "header header header"
                    "main main main"
                    "footer footer footer";
                grid-template-columns: 1fr;
            }

            .app-sidebar, .app-tools {
                position: fixed;
                top: 60px;
                bottom: 40px;
                width: 300px;
                z-index: 100;
                transition: transform 0.3s;
            }

            .app-sidebar {
                left: 0;
                transform: translateX(-100%);
            }

            .app-tools {
                right: 0;
                transform: translateX(100%);
            }

            .app-sidebar.visible, .app-tools.visible {
                transform: translateX(0);
            }
        }

        /* Syntax Highlighting (basic) */
        .token.comment {
            color: #6a9955;
        }
        .token.keyword {
            color: #569cd6;
        }
        .token.string {
            color: #ce9178;
        }
        .token.number {
            color: #b5cea8;
        }
        .token.function {
            color: #dcdcaa;
        }
        .token.operator {
            color: #d4d4d4;
        }
        .token.punctuation {
            color: #d4d4d4;
        }
    </style>
</head>
<body>
    <!-- WebGL Cosmic Background -->
    <canvas id="cosmic-canvas"></canvas>

    <!-- Main Application Container -->
    <div id="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">Cosmic Code Explorer</div>
            <div class="header-controls">
                <button id="run-btn" class="header-btn">Run Code</button>
                <button id="save-btn" class="header-btn">Save</button>
                <button id="sidebar-toggle" class="header-btn">Tutorials</button>
                <button id="tools-toggle" class="header-btn">Tools</button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="app-sidebar" id="app-sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Programming Tutorials</h3>
                <ul class="tutorial-list" id="tutorial-list">
                    <!-- Tutorial items will be added dynamically -->
                </ul>
            </div>
            <div class="sidebar-section">
                <h3 class="sidebar-title">Collaborators</h3>
                <div class="collab-users" id="collab-users">
                    <!-- User badges will be added dynamically -->
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="app-main">
            <div class="editor-container">
                <div class="editor-toolbar">
                    <button class="toolbar-btn" id="format-btn">Format</button>
                    <button class="toolbar-btn" id="analyze-btn">Analyze</button>
                    <button class="toolbar-btn" id="clear-btn">Clear</button>
                    <select class="toolbar-btn" id="language-select">
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                    </select>
                </div>
                <textarea id="code-editor" spellcheck="false">// Welcome to Cosmic Code Explorer!
// Start typing your code here...

function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}

console.log("Fibonacci sequence:");
for (let i = 0; i < 10; i++) {
    console.log(fibonacci(i));
}</textarea>
            </div>
            <div class="console-container" id="console-output">
                <div class="console-line info">Console ready. Click "Run Code" to execute your program.</div>
            </div>
        </main>

        <!-- Tools Panel -->
        <aside class="app-tools" id="app-tools">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Performance Metrics</h3>
                <div class="metrics-container">
                    <div class="metric-card">
                        <div class="metric-value" id="cpu-metric">0%</div>
                        <div class="metric-label">CPU Usage</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="memory-metric">0MB</div>
                        <div class="metric-label">Memory</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="fps-metric">0</div>
                        <div class="metric-label">FPS</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="latency-metric">0ms</div>
                        <div class="metric-label">Latency</div>
                    </div>
                </div>
            </div>
            <div class="sidebar-section">
                <h3 class="sidebar-title">Audio Visualizer</h3>
                <div class="visualizer-container" id="visualizer">
                    <!-- Audio bars will be added dynamically -->
                </div>
                <button id="audio-toggle" class="toolbar-btn" style="margin-top: 10px; width: 100%;">
                    Enable Audio
                </button>
            </div>
            <div class="sidebar-section plugins-container">
                <h3 class="sidebar-title">Plugins</h3>
                <div id="plugins-list">
                    <!-- Plugin cards will be added dynamically -->
                </div>
                <button id="plugin-load" class="toolbar-btn" style="margin-top: 10px; width: 100%;">
                    Load Plugin
                </button>
            </div>
        </aside>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="connection-status">Connected</span>
            </div>
            <div id="cursor-position">Ln 1, Col 1</div>
            <div id="file-info">Unsaved File.js</div>
        </footer>
    </div>

    <script>
        /**
         * Cosmic Code Explorer - Main Application
         * A complete web-based code exploration environment with WebGL visualization,
         * real-time collaboration, interactive tutorials, and performance monitoring.
         * 
         * This implementation is structured into modular classes with clean separation
         * of concerns and detailed documentation.
         */

        // ==============================================
        // Main Application Class
        // ==============================================

        class CosmicCodeExplorer {
            constructor() {
                // Initialize all application modules
                this.initModules();
                this.setupEventListeners();
                this.startApplication();
            }

            /**
             * Initialize all application modules
             */
            initModules() {
                // Core modules
                this.cosmicRenderer = new CosmicRenderer('cosmic-canvas');
                this.codeEditor = new CodeEditor('code-editor', 'console-output');
                this.tutorialSystem = new TutorialSystem('tutorial-list');
                this.collaborationSystem = new CollaborationSystem('collab-users');
                this.performanceMonitor = new PerformanceMonitor(
                    'cpu-metric', 'memory-metric', 'fps-metric', 'latency-metric'
                );
                this.audioVisualizer = new AudioVisualizer('visualizer', 'audio-toggle');
                this.pluginSystem = new PluginSystem('plugins-list', 'plugin-load');

                // UI State
                this.sidebarVisible = false;
                this.toolsVisible = false;
            }

            /**
             * Set up application event listeners
             */
            setupEventListeners() {
                // Button event listeners
                document.getElementById('run-btn').addEventListener('click', () => this.runCode());
                document.getElementById('save-btn').addEventListener('click', () => this.saveCode());
                document.getElementById('format-btn').addEventListener('click', () => this.formatCode());
                document.getElementById('analyze-btn').addEventListener('click', () => this.analyzeCode());
                document.getElementById('clear-btn').addEventListener('click', () => this.clearConsole());
                document.getElementById('sidebar-toggle').addEventListener('click', () => this.toggleSidebar());
                document.getElementById('tools-toggle').addEventListener('click', () => this.toggleTools());

                // Code editor cursor position tracking
                document.getElementById('code-editor').addEventListener('keyup', (e) => this.updateCursorPosition());
                document.getElementById('code-editor').addEventListener('click', (e) => this.updateCursorPosition());

                // Language selection change
                document.getElementById('language-select').addEventListener('change', (e) => {
                    this.codeEditor.setLanguage(e.target.value);
                });

                // Window resize handler
                window.addEventListener('resize', () => {
                    this.cosmicRenderer.handleResize();
                });
            }

            /**
             * Start the application
             */
            startApplication() {
                // Start the cosmic background animation
                this.cosmicRenderer.startAnimation();

                // Load initial tutorials
                this.tutorialSystem.loadTutorials();

                // Start performance monitoring
                this.performanceMonitor.startMonitoring();

                // Simulate some collaborators
                this.collaborationSystem.addUser('You', '#00d4ff');
                this.collaborationSystem.addUser('Alice', '#ff6b6b');
                this.collaborationSystem.addUser('Bob', '#6bff6b');

                // Load some default plugins
                this.pluginSystem.loadDefaultPlugins();

                // Update cursor position initially
                this.updateCursorPosition();
            }

            /**
             * Execute the current code in the editor
             */
            runCode() {
                const code = document.getElementById('code-editor').value;
                this.codeEditor.executeCode(code);
            }

            /**
             * Format the current code in the editor
             */
            formatCode() {
                this.codeEditor.formatCode();
                this.addConsoleMessage('Code formatted successfully.', 'success');
            }

            /**
             * Analyze the current code in the editor
             */
            analyzeCode() {
                const analysis = this.codeEditor.analyzeCode();
                this.addConsoleMessage('Code analysis completed:', 'info');
                
                // Display analysis results in console
                for (const [key, value] of Object.entries(analysis)) {
                    this.addConsoleMessage(`  ${key}: ${value}`, 'info');
                }
            }

            /**
             * Save the current code
             */
            saveCode() {
                // In a real app, this would save to server or local storage
                this.addConsoleMessage('Code saved successfully.', 'success');
                
                // Update file info in footer
                const language = document.getElementById('language-select').value;
                document.getElementById('file-info').textContent = `Saved File.${language}`;
            }

            /**
             * Clear the console output
             */
            clearConsole() {
                document.getElementById('console-output').innerHTML = '';
                this.addConsoleMessage('Console cleared.', 'info');
            }

            /**
             * Toggle the sidebar visibility
             */
            toggleSidebar() {
                this.sidebarVisible = !this.sidebarVisible;
                const sidebar = document.getElementById('app-sidebar');
                sidebar.classList.toggle('visible', this.sidebarVisible);
            }

            /**
             * Toggle the tools panel visibility
             */
            toggleTools() {
                this.toolsVisible = !this.toolsVisible;
                const tools = document.getElementById('app-tools');
                tools.classList.toggle('visible', this.toolsVisible);
            }

            /**
             * Update the cursor position display in the footer
             */
            updateCursorPosition() {
                const editor = document.getElementById('code-editor');
                const text = editor.value.substr(0, editor.selectionStart);
                const lines = text.split('\n');
                const lineNum = lines.length;
                const colNum = lines[lines.length - 1].length + 1;
                
                document.getElementById('cursor-position').textContent = `Ln ${lineNum}, Col ${colNum}`;
            }

            /**
             * Add a message to the console output
             * @param {string} message - The message to display
             * @param {string} type - The message type (info, success, warning, error)
             */
            addConsoleMessage(message, type = 'info') {
                const consoleOutput = document.getElementById('console-output');
                const line = document.createElement('div');
                line.className = `console-line ${type}`;
                line.textContent = message;
                consoleOutput.appendChild(line);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }
        }

        // ==============================================
        // CosmicRenderer - WebGL Cosmic Background
        // ==============================================

        class CosmicRenderer {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.gl = this.canvas.getContext('webgl') || this.canvas.getContext('experimental-webgl');
                
                if (!this.gl) {
                    console.error('WebGL not supported in your browser');
                    return;
                }
                
                this.initWebGL();
                this.createParticles();
                this.lastTime = 0;
                this.animationFrameId = null;
            }

            /**
             * Initialize WebGL context and shaders
             */
            initWebGL() {
                // Set canvas size
                this.handleResize();

                // Set clear color to dark space
                this.gl.clearColor(0.05, 0.05, 0.1, 1.0);
                this.gl.enable(this.gl.DEPTH_TEST);

                // Vertex shader source
                const vsSource = `
                    attribute vec2 aPosition;
                    attribute float aSize;
                    attribute vec3 aColor;
                    uniform float uTime;
                    varying vec3 vColor;
                    
                    void main() {
                        // Create subtle movement based on time and position
                        vec2 position = aPosition;
                        position.x += sin(uTime * 0.5 + aPosition.y) * 0.01;
                        position.y += cos(uTime * 0.3 + aPosition.x) * 0.01;
                        
                        gl_Position = vec4(position, 0.0, 1.0);
                        gl_PointSize = aSize + sin(uTime * 2.0 + aPosition.x) * 1.0;
                        vColor = aColor;
                    }
                `;

                // Fragment shader source
                const fsSource = `
                    precision mediump float;
                    varying vec3 vColor;
                    
                    void main() {
                        // Create a circular point with gradient
                        vec2 coord = gl_PointCoord - vec2(0.5);
                        float distance = length(coord);
                        float alpha = 1.0 - smoothstep(0.3, 0.5, distance);
                        
                        // Add glow effect
                        float glow = 0.2 / distance;
                        
                        gl_FragColor = vec4(vColor + vec3(glow * 0.3), alpha);
                    }
                `;

                // Compile shaders
                const vertexShader = this.compileShader(this.gl.VERTEX_SHADER, vsSource);
                const fragmentShader = this.compileShader(this.gl.FRAGMENT_SHADER, fsSource);

                // Create shader program
                this.shaderProgram = this.gl.createProgram();
                this.gl.attachShader(this.shaderProgram, vertexShader);
                this.gl.attachShader(this.shaderProgram, fragmentShader);
                this.gl.linkProgram(this.shaderProgram);

                if (!this.gl.getProgramParameter(this.shaderProgram, this.gl.LINK_STATUS)) {
                    console.error('Shader program linking error:', this.gl.getProgramInfoLog(this.shaderProgram));
                }

                // Get attribute and uniform locations
                this.attribLocations = {
                    position: this.gl.getAttribLocation(this.shaderProgram, 'aPosition'),
                    size: this.gl.getAttribLocation(this.shaderProgram, 'aSize'),
                    color: this.gl.getAttribLocation(this.shaderProgram, 'aColor')
                };
                
                this.uniformLocations = {
                    time: this.gl.getUniformLocation(this.shaderProgram, 'uTime')
                };
            }

            /**
             * Compile a shader from source
             * @param {number} type - Shader type (VERTEX_SHADER or FRAGMENT_SHADER)
             * @param {string} source - Shader source code
             * @returns {WebGLShader} Compiled shader
             */
            compileShader(type, source) {
                const shader = this.gl.createShader(type);
                this.gl.shaderSource(shader, source);
                this.gl.compileShader(shader);

                if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {
                    console.error('Shader compilation error:', this.gl.getShaderInfoLog(shader));
                    this.gl.deleteShader(shader);
                    return null;
                }

                return shader;
            }

            /**
             * Create particle data for the cosmic background
             */
            createParticles() {
                const PARTICLE_COUNT = 1000;
                
                // Create positions, sizes and colors for particles
                this.positions = new Float32Array(PARTICLE_COUNT * 2);
                this.sizes = new Float32Array(PARTICLE_COUNT);
                this.colors = new Float32Array(PARTICLE_COUNT * 3);
                
                for (let i = 0; i < PARTICLE_COUNT; i++) {
                    // Random positions in normalized device coordinates (-1 to 1)
                    this.positions[i * 2] = Math.random() * 2 - 1;
                    this.positions[i * 2 + 1] = Math.random() * 2 - 1;
                    
                    // Random sizes (1-4px)
                    this.sizes[i] = Math.random() * 3 + 1;
                    
                    // Random colors with blue/purple bias
                    this.colors[i * 3] = Math.random() * 0.3 + 0.2; // R
                    this.colors[i * 3 + 1] = Math.random() * 0.2 + 0.1; // G
                    this.colors[i * 3 + 2] = Math.random() * 0.5 + 0.5; // B
                }
                
                // Create and bind position buffer
                this.positionBuffer = this.gl.createBuffer();
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.positionBuffer);
                this.gl.bufferData(this.gl.ARRAY_BUFFER, this.positions, this.gl.STATIC_DRAW);
                
                // Create and bind size buffer
                this.sizeBuffer = this.gl.createBuffer();
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.sizeBuffer);
                this.gl.bufferData(this.gl.ARRAY_BUFFER, this.sizes, this.gl.STATIC_DRAW);
                
                // Create and bind color buffer
                this.colorBuffer = this.gl.createBuffer();
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.colorBuffer);
                this.gl.bufferData(this.gl.ARRAY_BUFFER, this.colors, this.gl.STATIC_DRAW);
            }

            /**
             * Handle window resize events
             */
            handleResize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.gl.viewport(0, 0, this.canvas.width, this.canvas.height);
            }

            /**
             * Start the animation loop
             */
            startAnimation() {
                if (!this.animationFrameId) {
                    this.lastTime = performance.now();
                    this.animationFrameId = requestAnimationFrame(this.animate.bind(this));
                }
            }

            /**
             * Stop the animation loop
             */
            stopAnimation() {
                if (this.animationFrameId) {
                    cancelAnimationFrame(this.animationFrameId);
                    this.animationFrameId = null;
                }
            }

            /**
             * Animation frame handler
             * @param {number} time - Current time in milliseconds
             */
            animate(time) {
                const deltaTime = time - this.lastTime;
                this.lastTime = time;
                
                // Clear the canvas
                this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);
                
                // Use our shader program
                this.gl.useProgram(this.shaderProgram);
                
                // Set the time uniform
                this.gl.uniform1f(this.uniformLocations.time, time * 0.001);
                
                // Enable and bind position attribute
                this.gl.enableVertexAttribArray(this.attribLocations.position);
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.positionBuffer);
                this.gl.vertexAttribPointer(this.attribLocations.position, 2, this.gl.FLOAT, false, 0, 0);
                
                // Enable and bind size attribute
                this.gl.enableVertexAttribArray(this.attribLocations.size);
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.sizeBuffer);
                this.gl.vertexAttribPointer(this.attribLocations.size, 1, this.gl.FLOAT, false, 0, 0);
                
                // Enable and bind color attribute
                this.gl.enableVertexAttribArray(this.attribLocations.color);
                this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.colorBuffer);
                this.gl.vertexAttribPointer(this.attribLocations.color, 3, this.gl.FLOAT, false, 0, 0);
                
                // Draw the particles
                this.gl.drawArrays(this.gl.POINTS, 0, this.positions.length / 2);
                
                // Continue the animation loop
                this.animationFrameId = requestAnimationFrame(this.animate.bind(this));
            }
        }

        // ==============================================
        // CodeEditor - Code Editing and Execution
        // ==============================================

        class CodeEditor {
            constructor(editorId, consoleId) {
                this.editorElement = document.getElementById(editorId);
                this.consoleElement = document.getElementById(consoleId);
                this.currentLanguage = 'javascript';
                this.setupEditor();
            }

            /**
             * Set up the code editor with basic functionality
             */
            setupEditor() {
                // Add basic syntax highlighting on keyup
                this.editorElement.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter' || e.key === 'Backspace' || e.key === ' ') {
                        this.applySyntaxHighlighting();
                    }
                });

                // Add tab support
                this.editorElement.addEventListener('keydown', (e) => {
                    if (e.key === 'Tab') {
                        e.preventDefault();
                        const start = this.editorElement.selectionStart;
                        const end = this.editorElement.selectionEnd;
                        
                        // Insert tab character
                        this.editorElement.value = this.editorElement.value.substring(0, start) + 
                            '  ' + this.editorElement.value.substring(end);
                        
                        // Move cursor
                        this.editorElement.selectionStart = this.editorElement.selectionEnd = start + 2;
                    }
                });
            }

            /**
             * Set the current programming language
             * @param {string} language - The language to set (javascript, python, etc.)
             */
            setLanguage(language) {
                this.currentLanguage = language;
                this.applySyntaxHighlighting();
            }

            /**
             * Execute the provided code
             * @param {string} code - The code to execute
             */
            executeCode(code) {
                // Clear console before execution
                this.consoleElement.innerHTML = '';
                this.addConsoleMessage(`Executing ${this.currentLanguage} code...`, 'info');

                try {
                    // Capture console.log output
                    const originalConsoleLog = console.log;
                    console.log = (...args) => {
                        this.addConsoleMessage(args.join(' '), 'info');
                        originalConsoleLog.apply(console, args);
                    };

                    // Execute based on language
                    if (this.currentLanguage === 'javascript') {
                        // Use Function constructor for safer execution
                        try {
                            const fn = new Function(code);
                            fn();
                            this.addConsoleMessage('Code executed successfully.', 'success');
                        } catch (e) {
                            this.addConsoleMessage(`Error: ${e.message}`, 'error');
                        }
                    } else if (this.currentLanguage === 'python') {
                        // In a real app, this would use a Python interpreter like Skulpt or Pyodide
                        this.addConsoleMessage('Python execution is not supported in this demo.', 'warning');
                    } else {
                        this.addConsoleMessage(`Language ${this.currentLanguage} is not supported for execution.`, 'warning');
                    }

                    // Restore original console.log
                    console.log = originalConsoleLog;
                } catch (e) {
                    this.addConsoleMessage(`Execution error: ${e.message}`, 'error');
                }
            }

            /**
             * Format the current code
             */
            formatCode() {
                // In a real app, this would use a proper formatter like Prettier
                // This is a simplified version for demo purposes
                const code = this.editorElement.value;
                
                // Basic formatting for JavaScript
                if (this.currentLanguage === 'javascript') {
                    // Add newlines after braces and semicolons
                    let formatted = code
                        .replace(/\{/g, ' {\n')
                        .replace(/\}/g, '\n}\n')
                        .replace(/;/g, ';\n')
                        .replace(/\n+/g, '\n');
                    
                    // Indent lines inside braces
                    let indentLevel = 0;
                    const lines = formatted.split('\n');
                    formatted = lines.map(line => {
                        if (line.includes('}')) indentLevel--;
                        const indentedLine = '  '.repeat(indentLevel) + line.trim();
                        if (line.includes('{')) indentLevel++;
                        return indentedLine;
                    }).join('\n');
                    
                    this.editorElement.value = formatted;
                }
            }

            /**
             * Analyze the current code
             * @returns {object} Analysis results
             */
            analyzeCode() {
                const code = this.editorElement.value;
                const analysis = {
                    lines: code.split('\n').length,
                    characters: code.length,
                    functions: (code.match(/function\s+\w+\s*\(/g) || []).length,
                    variables: (code.match(/(let|const|var)\s+\w+/g) || []).length,
                    complexity: this.calculateComplexity(code)
                };
                
                return analysis;
            }

            /**
             * Calculate code complexity (simplified)
             * @param {string} code - The code to analyze
             * @returns {number} Complexity score
             */
            calculateComplexity(code) {
                // Very basic complexity calculation
                let score = 0;
                
                // Count control structures
                const controls = ['if', 'for', 'while', 'switch', 'catch'];
                controls.forEach(keyword => {
                    score += (code.match(new RegExp(`\\b${keyword}\\b`, 'g')) || []).length;
                });
                
                // Count nested structures
                const nested = code.match(/\{[^{}]*\{/g) || [];
                score += nested.length * 2;
                
                return score;
            }

            /**
             * Apply basic syntax highlighting
             */
            applySyntaxHighlighting() {
                if (this.currentLanguage === 'javascript') {
                    this.highlightJavaScript();
                }
                // Other languages would be handled here
            }

            /**
             * JavaScript-specific syntax highlighting
             */
            highlightJavaScript() {
                const code = this.editorElement.value;
                const keywords = [
                    'function', 'return', 'if', 'else', 'for', 'while', 'do', 'switch', 
                    'case', 'break', 'continue', 'try', 'catch', 'throw', 'new', 'this',
                    'var', 'let', 'const', 'true', 'false', 'null', 'undefined', 'typeof',
                    'instanceof', 'delete', 'void', 'in', 'of', 'async', 'await', 'class',
                    'extends', 'super', 'import', 'export', 'default', 'yield'
                ];
                
                // Escape HTML in code
                let highlighted = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                // Highlight keywords
                keywords.forEach(keyword => {
                    const regex = new RegExp(`\\b${keyword}\\b`, 'g');
                    highlighted = highlighted.replace(regex, `<span class="token keyword">${keyword}</span>`);
                });
                
                // Highlight strings
                highlighted = highlighted.replace(/("([^"\\]|\\.)*"|'([^'\\]|\\.)*')/g, 
                    '<span class="token string">$&</span>');
                
                // Highlight numbers
                highlighted = highlighted.replace(/\b\d+\b/g, '<span class="token number">$&</span>');
                
                // Highlight comments
                highlighted = highlighted.replace(/\/\/.*|\/\*[\s\S]*?\*\//g, 
                    '<span class="token comment">$&</span>');
                
                // Highlight functions
                highlighted = highlighted.replace(/\b\w+(?=\()/g, 
                    '<span class="token function">$&</span>');
                
                // Highlight operators
                const operators = ['=', '==', '===', '!=', '!==', '<', '>', '<=', '>=', '=>', 
                                 '\\+', '-', '\\*', '/', '%', '\\+\\+', '--', '!', '&&', '\\|\\|'];
                operators.forEach(op => {
                    const regex = new RegExp(`(${op})`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="token operator">$1</span>');
                });
                
                // Highlight punctuation
                const punctuation = ['\\.', ',', ';', ':', '\\{', '\\}', '\\[', '\\]', '\\(', '\\)'];
                punctuation.forEach(p => {
                    const regex = new RegExp(`(${p})`, 'g');
                    highlighted = highlighted.replace(regex, '<span class="token punctuation">$1</span>');
                });
                
                // Save cursor position
                const start = this.editorElement.selectionStart;
                const end = this.editorElement.selectionEnd;
                
                // Update the editor with highlighted code
                this.editorElement.innerHTML = highlighted;
                
                // Restore cursor position
                this.editorElement.selectionStart = start;
                this.editorElement.selectionEnd = end;
            }

            /**
             * Add a message to the console
             * @param {string} message - The message to display
             * @param {string} type - The message type (info, success, warning, error)
             */
            addConsoleMessage(message, type = 'info') {
                const line = document.createElement('div');
                line.className = `console-line ${type}`;
                line.textContent = message;
                this.consoleElement.appendChild(line);
                this.consoleElement.scrollTop = this.consoleElement.scrollHeight;
            }
        }

        // ==============================================
        // TutorialSystem - Interactive Programming Tutorials
        // ==============================================

        class TutorialSystem {
            constructor(tutorialListId) {
                this.tutorialListElement = document.getElementById(tutorialListId);
                this.tutorials = [];
                this.currentTutorial = null;
            }

            /**
             * Load default tutorials
             */
            loadTutorials() {
                this.tutorials = [
                    { id: 'js-basics', title: 'JavaScript Basics', content: 'Learn the fundamentals of JavaScript...' },
                    { id: 'js-functions', title: 'Functions in JS', content: 'Understanding functions and scope...' },
                    { id: 'js-objects', title: 'Objects and Classes', content: 'Working with objects and OOP in JS...' },
                    { id: 'js-async', title: 'Async Programming', content: 'Callbacks, promises and async/await...' },
                    { id: 'js-dom', title: 'DOM Manipulation', content: 'Working with the Document Object Model...' },
                    { id: 'py-basics', title: 'Python Basics', content: 'Introduction to Python programming...' },
                    { id: 'py-functions', title: 'Python Functions', content: 'Defining and using functions in Python...' },
                    { id: 'py-classes', title: 'Python Classes', content: 'Object-oriented programming in Python...' },
                    { id: 'html-basics', title: 'HTML Basics', content: 'Structure of HTML documents...' },
                    { id: 'css-basics', title: 'CSS Basics', content: 'Styling web pages with CSS...' },
                    { id: 'algo-sorting', title: 'Sorting Algorithms', content: 'Bubble sort, quick sort, merge sort...' },
                    { id: 'algo-search', title: 'Search Algorithms', content: 'Linear search, binary search...' },
                    { id: 'ds-array', title: 'Arrays', content: 'Working with arrays and array methods...' },
                    { id: 'ds-list', title: 'Linked Lists', content: 'Implementing and using linked lists...' },
                    { id: 'ds-tree', title: 'Trees', content: 'Binary trees, BST, traversal algorithms...' },
                    { id: 'ds-graph', title: 'Graphs', content: 'Graph representation and algorithms...' },
                    { id: 'webgl-intro', title: 'WebGL Introduction', content: 'Basics of 3D graphics in the browser...' },
                    { id: 'webgl-shaders', title: 'WebGL Shaders', content: 'Writing vertex and fragment shaders...' },
                    { id: 'webgl-3d', title: '3D Graphics', content: 'Creating 3D objects and scenes...' },
                    { id: 'react-intro', title: 'React Basics', content: 'Introduction to React framework...' },
                    { id: 'react-hooks', title: 'React Hooks', content: 'Using useState, useEffect and more...' },
                    { id: 'node-intro', title: 'Node.js Basics', content: 'Server-side JavaScript with Node...' },
                    { id: 'express-intro', title: 'Express.js', content: 'Building web servers with Express...' },
                    { id: 'git-basics', title: 'Git Basics', content: 'Version control with Git...' },
                    { id: 'docker-intro', title: 'Docker Basics', content: 'Containerization with Docker...' }
                ];

                this.renderTutorialList();
            }

            /**
             * Render the tutorial list in the sidebar
             */
            renderTutorialList() {
                this.tutorialListElement.innerHTML = '';
                
                this.tutorials.forEach(tutorial => {
                    const item = document.createElement('li');
                    item.className = 'tutorial-item';
                    item.textContent = tutorial.title;
                    item.addEventListener('click', () => this.showTutorial(tutorial));
                    this.tutorialListElement.appendChild(item);
                });
            }

            /**
             * Display a tutorial
             * @param {object} tutorial - The tutorial to display
             */
            showTutorial(tutorial) {
                this.currentTutorial = tutorial;
                
                // Highlight selected tutorial in the list
                const items = this.tutorialListElement.querySelectorAll('.tutorial-item');
                items.forEach(item => {
                    item.classList.toggle('active', item.textContent === tutorial.title);
                });
                
                // In a real app, this would display the tutorial content in the main area
                console.log(`Showing tutorial: ${tutorial.title}`);
            }
        }

        // ==============================================
        // CollaborationSystem - Real-time Collaboration
        // ==============================================

        class CollaborationSystem {
            constructor(usersContainerId) {
                this.usersContainer = document.getElementById(usersContainerId);
                this.users = [];
                this.socket = null; // In a real app, this would be a WebSocket connection
            }

            /**
             * Add a user to the collaboration session
             * @param {string} name - The user's name
             * @param {string} color - The user's color
             */
            addUser(name, color) {
                const user = { id: this.generateId(), name, color };
                this.users.push(user);
                this.renderUser(user);
            }

            /**
             * Remove a user from the collaboration session
             * @param {string} id - The user's ID
             */
            removeUser(id) {
                this.users = this.users.filter(user => user.id !== id);
                this.renderUserList();
            }

            /**
             * Render a single user in the collaborators list
             * @param {object} user - The user to render
             */
            renderUser(user) {
                const userElement = document.createElement('div');
                userElement.className = 'user-badge';
                userElement.innerHTML = `
                    <div class="user-color" style="background-color: ${user.color};"></div>
                    <div class="user-name">${user.name}</div>
                `;
                this.usersContainer.appendChild(userElement);
            }

            /**
             * Render the complete user list
             */
            renderUserList() {
                this.usersContainer.innerHTML = '';
                this.users.forEach(user => this.renderUser(user));
            }

            /**
             * Generate a random ID for users
             * @returns {string} A random ID
             */
            generateId() {
                return Math.random().toString(36).substr(2, 9);
            }

            /**
             * Simulate receiving a code change from another user
             * @param {string} userId - The ID of the user making the change
             * @param {string} change - The code change
             */
            receiveChange(userId, change) {
                const user = this.users.find(u => u.id === userId);
                if (user) {
                    console.log(`Received change from ${user.name}: ${change}`);
                }
            }

            /**
             * Send a code change to other collaborators
             * @param {string} change - The code change
             */
            sendChange(change) {
                // In a real app, this would send the change via WebSocket
                console.log(`Sending change: ${change}`);
            }
        }

        // ==============================================
        // PerformanceMonitor - System Metrics Dashboard
        // ==============================================

        class PerformanceMonitor {
            constructor(cpuId, memoryId, fpsId, latencyId) {
                this.cpuElement = document.getElementById(cpuId);
                this.memoryElement = document.getElementById(memoryId);
                this.fpsElement = document.getElementById(fpsId);
                this.latencyElement = document.getElementById(latencyId);
                
                this.cpuUsage = 0;
                this.memoryUsage = 0;
                this.fps = 0;
                this.latency = 0;
                
                this.lastFrameTime = performance.now();
                this.frameCount = 0;
                this.lastFpsUpdate = 0;
            }

            /**
             * Start monitoring performance metrics
             */
            startMonitoring() {
                // Update metrics every second
                setInterval(() => this.updateMetrics(), 1000);
                
                // Start FPS tracking
                requestAnimationFrame(this.trackFPS.bind(this));
            }

            /**
             * Update all performance metrics
             */
            updateMetrics() {
                // Simulate varying metrics
                this.cpuUsage = Math.min(100, Math.max(0, this.cpuUsage + (Math.random() * 6 - 3)));
                this.memoryUsage = Math.floor(Math.random() * 200) + 50;
                this.latency = Math.floor(Math.random() * 50) + 10;
                
                // Update DOM elements
                this.cpuElement.textContent = `${this.cpuUsage.toFixed(1)}%`;
                this.memoryElement.textContent = `${this.memoryUsage}MB`;
                this.latencyElement.textContent = `${this.latency}ms`;
            }

            /**
             * Track frames per second
             * @param {number} time - Current timestamp
             */
            trackFPS(time) {
                // Calculate FPS
                this.frameCount++;
                
                if (time >= this.lastFpsUpdate + 1000) {
                    this.fps = Math.round((this.frameCount * 1000) / (time - this.lastFpsUpdate));
                    this.fpsElement.textContent = this.fps;
                    
                    this.frameCount = 0;
                    this.lastFpsUpdate = time;
                }
                
                // Continue tracking
                requestAnimationFrame(this.trackFPS.bind(this));
            }
        }

        // ==============================================
        // AudioVisualizer - Audio-responsive Visualization
        // ==============================================

        class AudioVisualizer {
            constructor(containerId, toggleId) {
                this.container = document.getElementById(containerId);
                this.toggleButton = document.getElementById(toggleId);
                this.audioContext = null;
                this.analyser = null;
                this.microphone = null;
                this.isActive = false;
                this.bars = [];
                
                this.setupVisualizer();
                this.setupEventListeners();
            }

            /**
             * Set up the visualizer elements
             */
            setupVisualizer() {
                // Create audio bars
                const barCount = 64;
                for (let i = 0; i < barCount; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'audio-bar';
                    bar.style.left = `${(i / barCount) * 100}%`;
                    this.container.appendChild(bar);
                    this.bars.push(bar);
                }
            }

            /**
             * Set up event listeners
             */
            setupEventListeners() {
                this.toggleButton.addEventListener('click', () => {
                    this.isActive ? this.stopAudio() : this.startAudio();
                });
            }

            /**
             * Start audio visualization
             */
            startAudio() {
                try {
                    // Create audio context
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 256;
                    
                    // Get microphone input
                    navigator.mediaDevices.getUserMedia({ audio: true, video: false })
                        .then(stream => {
                            this.microphone = this.audioContext.createMediaStreamSource(stream);
                            this.microphone.connect(this.analyser);
                            
                            this.isActive = true;
                            this.toggleButton.textContent = 'Disable Audio';
                            this.visualizeAudio();
                        })
                        .catch(err => {
                            console.error('Error accessing microphone:', err);
                            this.toggleButton.textContent = 'Mic Access Denied';
                        });
                } catch (err) {
                    console.error('Error initializing audio:', err);
                    this.toggleButton.textContent = 'Audio Unavailable';
                }
            }

            /**
             * Stop audio visualization
             */
            stopAudio() {
                if (this.microphone) {
                    this.microphone.disconnect();
                    this.microphone = null;
                }
                
                if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                }
                
                this.isActive = false;
                this.toggleButton.textContent = 'Enable Audio';
                
                // Reset bars
                this.bars.forEach(bar => {
                    bar.style.height = '0%';
                });
            }

            /**
             * Visualize audio data
             */
            visualizeAudio() {
                if (!this.isActive) return;
                
                const bufferLength = this.analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                this.analyser.getByteFrequencyData(dataArray);
                
                // Update bars based on frequency data
                this.bars.forEach((bar, i) => {
                    const value = dataArray[i] || 0;
                    const height = `${value / 2}%`;
                    bar.style.height = height;
                    bar.style.backgroundColor = `hsl(${value + 180}, 100%, 50%)`;
                });
                
                // Continue animation
                requestAnimationFrame(() => this.visualizeAudio());
            }
        }

        // ==============================================
        // PluginSystem - Extensible Plugin Architecture
        // ==============================================

        class PluginSystem {
            constructor(containerId, loadButtonId) {
                this.pluginsContainer = document.getElementById(containerId);
                this.loadButton = document.getElementById(loadButtonId);
                this.plugins = [];
                
                this.setupEventListeners();
            }

            /**
             * Set up event listeners
             */
            setupEventListeners() {
                this.loadButton.addEventListener('click', () => this.promptLoadPlugin());
            }

            /**
             * Load default plugins
             */
            loadDefaultPlugins() {
                this.addPlugin({
                    name: 'Code Formatter',
                    description: 'Formats code according to standard style guidelines',
                    author: 'Cosmic Team',
                    version: '1.0.0'
                });
                
                this.addPlugin({
                    name: 'Linter',
                    description: 'Analyzes code for potential errors and style issues',
                    author: 'Cosmic Team',
                    version: '1.2.0'
                });
                
                this.addPlugin({
                    name: 'Code Minifier',
                    description: 'Minifies JavaScript code for production',
                    author: 'Cosmic Team',
                    version: '1.1.0'
                });
            }

            /**
             * Prompt user to load a new plugin
             */
            promptLoadPlugin() {
                // In a real app, this would allow loading actual plugin files
                const pluginName = prompt('Enter plugin name:');
                if (pluginName) {
                    this.addPlugin({
                        name: pluginName,
                        description: 'Custom user plugin',
                        author: 'User',
                        version: '1.0.0'
                    });
                }
            }

            /**
             * Add a new plugin
             * @param {object} plugin - Plugin definition
             */
            addPlugin(plugin) {
                plugin.id = this.generateId();
                this.plugins.push(plugin);
                this.renderPlugin(plugin);
            }

            /**
             * Remove a plugin
             * @param {string} id - Plugin ID
             */
            removePlugin(id) {
                this.plugins = this.plugins.filter(p => p.id !== id);
                this.renderAllPlugins();
            }

            /**
             * Render a single plugin card
             * @param {object} plugin - Plugin to render
             */
            renderPlugin(plugin) {
                const pluginCard = document.createElement('div');
                pluginCard.className = 'plugin-card';
                pluginCard.innerHTML = `
                    <div class="plugin-header">
                        <span class="plugin-name">${plugin.name}</span>
                        <button class="plugin-btn remove-btn" data-id="${plugin.id}">Remove</button>
                    </div>
                    <div class="plugin-description">${plugin.description}</div>
                    <div class="plugin-meta">v${plugin.version} by ${plugin.author}</div>
                `;
                
                this.pluginsContainer.appendChild(pluginCard);
                
                // Add event listener to remove button
                pluginCard.querySelector('.remove-btn').addEventListener('click', (e) => {
                    this.removePlugin(e.target.dataset.id);
                });
            }

            /**
             * Render all plugins
             */
            renderAllPlugins() {
                this.pluginsContainer.innerHTML = '';
                this.plugins.forEach(plugin => this.renderPlugin(plugin));
            }

            /**
             * Generate a random ID for plugins
             * @returns {string} A random ID
             */
            generateId() {
                return Math.random().toString(36).substr(2, 9);
            }
        }

        // ==============================================
        // Initialize the Application
        // ==============================================

        // Start the Cosmic Code Explorer when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const app = new CosmicCodeExplorer();
        });

    </script>
</body>
</html>
